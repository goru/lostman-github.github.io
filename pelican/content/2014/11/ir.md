Title: Arduinoをリモコンにしてみる
Date: 2014-11-25 23:02
Category: Embedded
Tags: Arduino
Slug: ir

秋月電子で赤外線の受信モジュールとLEDを購入して学習リモコン的なものを作ってみた  
今回使用したものは以下の通り

* Arduino Uno
* 赤外線リモコン受信モジュール [GP1UXC41QS](http://akizukidenshi.com/catalog/g/gI-06487/) を1個、1個50円
* 5mm赤外線LED [OSI5LA5113A](http://akizukidenshi.com/catalog/g/gI-04311/) を3個、10個100円
* タクトスイッチ [DTS-6](http://akizukidenshi.com/catalog/g/gP-03647/) を1個、1個10円
* プルダウン用の抵抗1KΩを1個

それぞれの部品を以下のように接続

Arduino | 部品
--------|-----------------
2       | GP1UXC41QSのVout
GND     | GP1UXC41QSのGND
5V      | GP1UXC41QSのVcc
5V      | タクトスイッチの2番
3       | タクトスイッチの4番 (プルダウン抵抗をつける)
4       | OSI5LA5113Aの+
GND     | OSI5LA5113Aの-

GP1UXC41QSのデータシートの `6. 製品の実装について` の項に `CRフィルターを実装してください` とある  
手元の環境では省略していても特に問題は起きていないが今回の回路は誤動作する可能性があるので注意

実際に接続するとこのようになる

<p class="center-text">
<a class="image-box" href="/static/images/2014/11/IMAG1268.jpg">
<img src="/static/images/2014/11/IMAG1268.jpg" width="30%" height="30%">
</a>
</p>

Arduinoのソースコードは [Github](https://github.com/lostman-github/arduino/blob/master/Uno/IR/sample/sample.ino) に置いてある

書き込んでシリアルモニタを表示すると `.` が1秒毎に表示される、これは受信状態を表している  
この状態で本物のリモコンのボタンをを押すと読み込んで結果を出力する

ここで出力される情報は他の色々なサイトで見ることができるサンプルと同様に  
センサの出力が切り替わるまでの時間を10µs単位で計測したもので、 `4384,1032,510,67,....` と出力されたら  
先頭から43840µsの無通信時間(OFF)、10320µsのON、5100µsのOFF、670µsのONを表している  
先頭の無通信時間は不要な情報なので、これを除外してソースに埋め込めばArduinoで再現させることができる

タクトスイッチを押すと `Send` が表示されソースコードに埋め込まれている情報を元にLEDを発光させる

実行例

    :::
    .
    .
    .4384,1032,510,67,62,67,62,66,187,67,61,70,62,66,61,67,62,67,187,69,188,66,62,66,61,67,62,69,187,67,61,66,187,67,61,70,61,66,187,67,62,66,188,70,187,66,62,66,62,66,187,69,188,66,61,66,188,66,61,70,62,66,188,66,187,66,62,66,
    .
    .
    .
    .
    .
    Send
    .
    .
    .

ソースコードに関しては他のサイトを参考にして簡潔になるようにしたので特に難しい点もなく  
細かい説明は説明は不要だと思われるけれど、LEDの光量に関しては確認する方法もなくハマったのでメモしておく

作成にあたってソースコードははじめからほぼ最終形に近い形になっていた  
ただ受信は期待通り動作していたんだけれど、送信が全く動かなくて原因もわかっていなかった

携帯のカメラを使ってLEDが発光していることは確認できていたので、38KHzのパルスができていないのかと思い  
もう一台のArduinoを使って送信したものを受信してみたりして間隔の調整を色々試したけれどうまくいかなかった

なんとなく本物のリモコンをカメラで見てみたら今回使用しているLEDよりもかなり明るく見えたのと  
LEDが3つ付いていることに気がついた、それでなんとなく光量が足りていないのかと感じたので  
初期は1個だったLEDを3個に増やしてみたら期待通り動作するようになった

LEDの発振の調整についてはオシロを持っていればそれで確認できるが  
赤外線LEDの光量についてはカメラで覗いてみてなんとなく明るいかそうでないか程度の  
確認しかできない人がほとんどだと思う (専門の道具があるのかもしれないけれど)  
なので簡単に判別することができず、ここが問題点だと気がつくことが難しいのではないかと思う  
うまく動作しない時は本物のリモコンの明るさと一度比べてみることをおすすめ

参考にしたサイト

* [赤外線リモコンの通信フォーマット](http://elm-chan.org/docs/ir_format.html)
* [リモコンフォーマット](http://akizukidenshi.com/download/k4174_format.pdf)
* [ArduinoとRubyで赤外線リモコン作ってWebから操作できるようにした](http://shokai.org/blog/archives/8012)
* [Arduinoでリモコン作成](http://eikatou.net/blog/2012/07/1796/)
* [Arduinoで学習リモコン](http://d.hatena.ne.jp/NeoCat/20090419/1240158722)
