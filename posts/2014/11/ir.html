<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Arduinoをリモコンにしてみる - blog.gorugle.org</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    


    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>


</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">
blog.gorugle.org            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="/category/computer.html">Computer</a>
                        </li>
                        <li class="active">
                            <a href="/category/embedded.html">Embedded</a>
                        </li>
                        <li >
                            <a href="/category/gadget.html">Gadget</a>
                        </li>
                        <li >
                            <a href="/category/internet.html">Internet</a>
                        </li>
                        <li >
                            <a href="/category/misc.html">Misc</a>
                        </li>
                        <li >
                            <a href="/category/programming.html">Programming</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/posts/2014/11/ir.html"
                       rel="bookmark"
                       title="Permalink to Arduinoをリモコンにしてみる">
                        Arduinoをリモコンにしてみる
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <time datetime="2014-11-25T23:02:00+09:00"> 2014/11/25 Tue</time>
    </span>



<span class="label label-default">Tags</span>
	<a href="/tag/arduino.html">Arduino</a>
        /
	<a href="/tag/ir.html">IR</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>秋月電子で赤外線の受信モジュールとLEDを購入して学習リモコン的なものを作ってみた<br />
今回使用したのは以下の部品</p>
<ul>
<li>Arduino Uno</li>
<li>赤外線リモコン受信モジュール <a href="http://akizukidenshi.com/catalog/g/gI-06487/">GP1UXC41QS</a> x1 1個50円</li>
<li>5mm赤外線LED <a href="http://akizukidenshi.com/catalog/g/gI-04311/">OSI5LA5113A</a> x3 10個100円</li>
<li>タクトスイッチ <a href="http://akizukidenshi.com/catalog/g/gP-03647/">DTS-6</a> x1 1個10円</li>
<li>プルダウン用の抵抗1KΩ x1</li>
</ul>
<p>それぞれを以下のように接続した</p>
<table>
<thead>
<tr>
<th>Arduino</th>
<th>部品</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>GP1UXC41QSのVout</td>
</tr>
<tr>
<td>GND</td>
<td>GP1UXC41QSのGND</td>
</tr>
<tr>
<td>5V</td>
<td>GP1UXC41QSのVcc</td>
</tr>
<tr>
<td>5V</td>
<td>タクトスイッチの2番</td>
</tr>
<tr>
<td>3</td>
<td>タクトスイッチの4番 (プルダウン抵抗をつける)</td>
</tr>
<tr>
<td>4</td>
<td>OSI5LA5113A x3 の+</td>
</tr>
<tr>
<td>GND</td>
<td>OSI5LA5113A x3 の-</td>
</tr>
</tbody>
</table>
<p>GP1UXC41QSのデータシートの <code>6. 製品の実装について</code> の項に <code>CRフィルターを実装してください</code> とあるけれど<br />
お試しなので今回は省略して回路を組んだ<br />
手元の環境では特に問題は起きていないけれど誤動作する可能性があるので注意</p>
<p>実際に接続するとこのようになる</p>
<p><a href="/static/images/2014/11/IMAG1268.jpg"><img alt="image" src="/static/images/2014/11/IMAG1268_s.jpg" /></a></p>
<p>ソースコードは <a href="https://github.com/lostman-github/arduino/blob/master/Uno/IR/sample/sample.ino">Github</a> に置いてある</p>
<p>書き込んでシリアルモニタを表示すると <code>.</code> が1秒毎に表示される、これは受信状態であることを表している<br />
この状態で本物のリモコンをセンサに向けてボタンを押すと読み込んだ結果を出力する</p>
<p>ここで出力される情報は他の色々なサイトで見ることができるサンプルと同様に<br />
センサの出力の値が切り替わるまでの時間を10µs単位で計測したもの<br />
<code>4384,1032,510,67,....</code> と出力されたら、先頭から43840µsのOFF、10320µsのON、5100µsのOFF、670µsのONを表している<br />
先頭のOFFは無通信時間で不要な情報なので、これを除外してソースに埋め込めばこのデータを使ってLEDを発光させることができる</p>
<p>タクトスイッチを押すと <code>Send</code> が表示されソースコードに埋め込まれている情報を元にLEDを発光させる</p>
<p>実行例</p>
<div class="highlight"><pre>.
.
.4384,1032,510,67,62,67,62,66,187,67,61,70,62,66,61,67,62,67,187,69,188,66,62,66,61,67,62,69,187,67,61,66,187,67,61,70,61,66,187,67,62,66,188,70,187,66,62,66,62,66,187,69,188,66,61,66,188,66,61,70,62,66,188,66,187,66,62,66,
.
.
.
.
.
Send
.
.
.
</pre></div>


<p>ソースに関しては他のサイトを参考にして簡潔になるように書きなおした程度で<br />
細かい説明は説明は不要だと思われるけれど、1点ハマったポイントがあったので経緯をメモしておく</p>
<p>作成にあたってソースコードは初めからほぼ最終形に近い形になっていて、受信に関しては期待通り動作していた<br />
ただ送信が全く動かなくて原因もよくわからない状態だった</p>
<p>赤外線は携帯のカメラを使うと見ることができるので、それでLEDが発光していることは確認した<br />
とりあえず光っていることは確認できたので受信側が認識するために必要な38KHzが<br />
うまく作り出せていないのかと思ってオシロで確認する以外に何か方法がないか考えてみた<br />
よくよく考えたら単純に自分で送信したものを今回作成した受信部で受信して、<br />
本物のリモコンと同じ結果になっていることを確認すればいいことに気がついた</p>
<p>試してみたら本物のリモコンはきっちり毎回同じ結果が出力されるのに対し、自作の方は安定しない様子<br />
色々本物のリモコンが再現できるように調節しようとしてみたけれど<br />
Arduinoの性能に依存しているのか完璧に再現することはできなかった</p>
<p>で、色々やっている時にふと気がついて本物のリモコンを携帯のカメラで覗いてみたら<br />
今回使用しているLEDよりずいぶん明るく見えたのと、LEDが1個でなく3個付いていることに気がついた<br />
そこで自作の方も元々は1個だったんだけれど、3個に増やしてみたら期待通りに動作するようになった</p>
<p>期待通りの信号が送信できているかについては、自分で受信してみるか、オシロで確認<br />
光量については本物のリモコンと自作のものをカメラを使って目でで確認するしかない<br />
受信側が認識できるくらいの光量を確保しなければいけないので、同じ部品、同じソースを使っても<br />
受信側の機器が異なっていればうまく動作しないことがあることがわかった</p>
<p>参考にしたサイト</p>
<ul>
<li><a href="http://elm-chan.org/docs/ir_format.html">赤外線リモコンの通信フォーマット</a></li>
<li><a href="http://akizukidenshi.com/download/k4174_format.pdf">リモコンフォーマット</a></li>
<li><a href="http://shokai.org/blog/archives/8012">ArduinoとRubyで赤外線リモコン作ってWebから操作できるようにした</a></li>
<li><a href="http://eikatou.net/blog/2012/07/1796/">Arduinoでリモコン作成</a></li>
<li><a href="http://d.hatena.ne.jp/NeoCat/20090419/1240158722">Arduinoで学習リモコン</a></li>
</ul>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">



                <li class="list-group-item"><a href="/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                    <ul class="list-group" id="tags">
                    </ul>
                </li>    

    <li class="list-group-item"><h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
            <a href="https://github.com/lostman-github">@lostman-github</a> on GitHub
    </li>

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2015 lostman/ごる
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="//code.jquery.com/jquery.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = '/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'lostman-github',
                count: 5,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="/theme/js/github.js" type="text/javascript"></script>
</body>
</html>