<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>AquesTalk pico LSIをI2Cで接続する</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">blog.gorugle.org </a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/embedded.html">Embedded</a></li>
                    <li><a href="/category/internet.html">Internet</a></li>
                    <li><a href="/category/misc.html">misc</a></li>
                    <li><a href="/category/programming.html">Programming</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/posts/2014/07/aquestalk-i2c.html" rel="bookmark"
           title="Permalink to AquesTalk pico LSIをI2Cで接続する">AquesTalk pico LSIをI2Cで接続する</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-07-25T23:49:00">
                Published: 2014/07/25 Fri
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/lostmangoru.html">lostman/ごる</a>
        </address>
<p>In <a href="/category/embedded.html">Embedded</a>. </p>
<p>tags: <a href="/tag/arduino.html">Arduino</a> <a href="/tag/aquestalk-pico-lsi.html">AquesTalk pico LSI</a> </p>
</footer><!-- /.post-info -->      <p>ArduinoとAquesTalkをI2Cで接続してみました<br/>
配線は以下の通り<br/>
(表にしたらテーマの関係上すごく見づらかったので変更する予定)</p>
<div class="highlight"><pre>PIN | AquesTalk | -&gt; | Arduino
----|-----------|----|--------
1   | /RESET    |    | RESET
4   | SMOD0     |    | GND
5   | SMOD1     |    | 5V
7   | VCC       |    | 5V
8   | GND       |    | GND
20  | VCC       |    | 5V
22  | GND       |    | GND
27  | SDA       |    | A4
28  | SCL       |    | A5
</pre></div>
<p>SMOD0/SMOD1についてはデータシートの 表9.1 通信モード を参照<br/>
I2Cで接続するには SMOD0 = 0, SMOD1 = 1 にする必要があります<br/>
あとは12番のAOUTをアンプのIN+、GNDをIN-に接続します</p>
<p><img alt="AquesTalk pico LSI I2C" src="/static/images/2014/07/IMAG1036.jpg" style="width: 3264px; height: auto; max-width: 100%;"/></p>
<p>データシートの 5. 基本回路 にある回路図を見ると、これ以外にVCCとAOUTにコンデンサが追加されています<br/>
これはバイパスコンデンサというものらしく電源の安定化やノイズの発生を抑えたりする役割があるそうです <a href="http://www.geocities.jp/zattouka/GarageHouse/micon/circuit/VoltREG.htm#pascon">*1</a><br/>
とりあえず、無しでも動きました(ぇ</p>
<p>他に 9.2. I2C通信 の部分を見るとSDA、SCL共に5KΩ程度のプルアップ抵抗が必要とあります<br/>
プルアップ抵抗なんですが調べたところ標準のWire.hを使う場合Arduino内蔵の抵抗で問題なさそうなので <a href="http://www.senio.co.jp/bbs/viewtopic.php?f=7&amp;t=260">*2</a> <a href="http://myboom.mkch.net/modules/pukiwiki/180.html">*3</a><br/>
これも無しで試したところ、動きました</p>
<p>というわけでAquesTalk以外に特に部品を追加することなく準備ができました<br/>
動作確認に使用したスケッチは<a href="https://github.com/lostman-github/arduino/blob/master/Uno/AquesTalk/sample/sample.ino">GitHub</a>にありますがここに貼り付けておきます <a href="http://enajet.air-nifty.com/blog/2012/01/aquestalk-pico-.html">*4</a></p>
<div class="highlight"><pre><span class="cp">#include &lt;Wire.h&gt;</span>

<span class="cp">#define PICO_I2C_ADDRESS 0x2E</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">isReady</span><span class="p">();</span>

  <span class="n">Wire</span><span class="p">.</span><span class="n">beginTransmission</span><span class="p">(</span><span class="n">PICO_I2C_ADDRESS</span><span class="p">);</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"yukkurisiteittene</span><span class="se">\r</span><span class="s">"</span><span class="p">);</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">endTransmission</span><span class="p">();</span>

  <span class="c1">// send once</span>
  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">isReady</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Wire</span><span class="p">.</span><span class="n">requestFrom</span><span class="p">(</span><span class="n">PICO_I2C_ADDRESS</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">while</span><span class="p">(</span><span class="n">Wire</span><span class="p">.</span><span class="n">available</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="n">Wire</span><span class="p">.</span><span class="n">read</span><span class="p">()</span> <span class="o">==</span> <span class="sc">'&gt;'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>