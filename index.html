<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>blog.gorugle.org</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">blog.gorugle.org </a></h1>
                <nav><ul>
                    <li><a href="/category/embedded.html">Embedded</a></li>
                    <li><a href="/category/internet.html">Internet</a></li>
                    <li><a href="/category/misc.html">misc</a></li>
                    <li><a href="/category/programming.html">Programming</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/posts/2014/07/aquestalk-i2c.html">AquesTalk pico LSIをI2Cで接続する</a></h1>
<footer class="post-info">
        <abbr class="published" title="2014-07-25T23:49:00">
                Published: 2014/07/25 Fri
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/lostmangoru.html">lostman/ごる</a>
        </address>
<p>In <a href="/category/embedded.html">Embedded</a>. </p>
<p>tags: <a href="/tag/arduino.html">Arduino</a> <a href="/tag/aquestalk-pico-lsi.html">AquesTalk pico LSI</a> </p>
</footer><!-- /.post-info --><p>ArduinoとAquesTalkをI2Cで接続してみました<br/>
配線は以下の通り<br/>
(表にしたらテーマの関係上すごく見づらかったので変更する予定)</p>
<div class="highlight"><pre>PIN | AquesTalk | -&gt; | Arduino
----|-----------|----|--------
1   | /RESET    |    | RESET
4   | SMOD0     |    | GND
5   | SMOD1     |    | 5V
7   | VCC       |    | 5V
8   | GND       |    | GND
20  | VCC       |    | 5V
22  | GND       |    | GND
27  | SDA       |    | A4
28  | SCL       |    | A5
</pre></div>
<p>SMOD0/SMOD1についてはデータシートの 表9.1 通信モード を参照<br/>
I2Cで接続するには SMOD0 = 0, SMOD1 = 1 にする必要があります<br/>
あとは12番のAOUTをアンプのIN+、GNDをIN-に接続します</p>
<p><img alt="AquesTalk pico LSI I2C" src="/static/images/2014/07/IMAG1036.jpg" style="width: 3264px; height: auto; max-width: 100%;"/></p>
<p>データシートの 5. 基本回路 にある回路図を見ると、これ以外にVCCとAOUTにコンデンサが追加されています<br/>
これはバイパスコンデンサというものらしく電源の安定化やノイズの発生を抑えたりする役割があるそうです <a href="http://www.geocities.jp/zattouka/GarageHouse/micon/circuit/VoltREG.htm#pascon">*1</a><br/>
とりあえず、無しでも動きました(ぇ</p>
<p>他に 9.2. I2C通信 の部分を見るとSDA、SCL共に5KΩ程度のプルアップ抵抗が必要とあります<br/>
プルアップ抵抗なんですが調べたところ標準のWire.hを使う場合Arduino内蔵の抵抗で問題なさそうなので <a href="http://www.senio.co.jp/bbs/viewtopic.php?f=7&amp;t=260">*2</a> <a href="http://myboom.mkch.net/modules/pukiwiki/180.html">*3</a><br/>
これも無しで試したところ、動きました</p>
<p>というわけでAquesTalk以外に特に部品を追加することなく準備ができました<br/>
動作確認に使用したスケッチは<a href="https://github.com/lostman-github/arduino/blob/master/Uno/AquesTalk/sample/sample.ino">GitHub</a>にありますがここに貼り付けておきます <a href="http://enajet.air-nifty.com/blog/2012/01/aquestalk-pico-.html">*4</a></p>
<div class="highlight"><pre><span class="cp">#include &lt;Wire.h&gt;</span>

<span class="cp">#define PICO_I2C_ADDRESS 0x2E</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">isReady</span><span class="p">();</span>

  <span class="n">Wire</span><span class="p">.</span><span class="n">beginTransmission</span><span class="p">(</span><span class="n">PICO_I2C_ADDRESS</span><span class="p">);</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"yukkurisiteittene</span><span class="se">\r</span><span class="s">"</span><span class="p">);</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">endTransmission</span><span class="p">();</span>

  <span class="c1">// send once</span>
  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">isReady</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Wire</span><span class="p">.</span><span class="n">requestFrom</span><span class="p">(</span><span class="n">PICO_I2C_ADDRESS</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">while</span><span class="p">(</span><span class="n">Wire</span><span class="p">.</span><span class="n">available</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="n">Wire</span><span class="p">.</span><span class="n">read</span><span class="p">()</span> <span class="o">==</span> <span class="sc">'&gt;'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/2014/07/github-pages.html" rel="bookmark"
                           title="Permalink to GitHub Pages関連で調べたこと">GitHub Pages関連で調べたこと</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-07-24T00:16:00">
                Published: 2014/07/24 Thu
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/lostmangoru.html">lostman/ごる</a>
        </address>
<p>In <a href="/category/internet.html">Internet</a>. </p>
<p>tags: <a href="/tag/github.html">GitHub</a> </p>
</footer><!-- /.post-info -->                <ul>
<li><a href="https://help.github.com/articles/adding-a-cname-file-to-your-repository">Adding a CNAME file to your repository</a><br/>
  サブドメインを使用する場合はリポジトリに割り当てたいサブドメインを書いた <code>CNAME</code> ファイルを追加するのと、<br/>
  使用しているDNSの設定でサブドメインと <code>hoge.github.io</code> をCNAMEで関連付ける</li>
<li><a href="https://help.github.com/articles/using-submodules-with-pages">Using submodules with Pages</a><br/>
  gitのsubmoduleを使用する場合、リポジトリのURLは <code>git://</code> でなく <code>https://</code> を使用しなければいけない</li>
<li><a href="https://help.github.com/articles/using-jekyll-with-pages#turning-jekyll-off">Turning Jekyll off</a><br/>
  デフォルトでJekyllが有効になっているので <code>*.rst</code> なファイルをアップロードすると変換しようとする<br/>
  これを無効にするために <code>.nojekyll</code> をリポジトリのルートに作成する</li>
</ul>
                <a class="readmore" href="/posts/2014/07/github-pages.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/2014/07/aquestalk.html" rel="bookmark"
                           title="Permalink to AquesTalk pico LSIの動作確認">AquesTalk pico LSIの動作確認</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-07-21T17:49:00">
                Published: 2014/07/21 Mon
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/lostmangoru.html">lostman/ごる</a>
        </address>
<p>In <a href="/category/embedded.html">Embedded</a>. </p>
<p>tags: <a href="/tag/arduino.html">Arduino</a> <a href="/tag/aquestalk-pico-lsi.html">AquesTalk pico LSI</a> </p>
</footer><!-- /.post-info -->                <p>以前購入していた<a href="http://www.a-quest.com/products/aquestalkpicolsi.html">ATP3011F1-PU</a>(<a href="http://akizukidenshi.com/catalog/g/gI-06220/">秋月</a>で850円)の動作確認をしてみました<br/>
紹介動画にもありますがArduino UNOに挿してアンプ付きのスピーカと接続、<br/>
PCからシリアルモニタで文字を送信するだけで音声を出すことができます<br/>
(技術資料 13.4. Arduinoボードを利用した簡易動作 を参照)<br/>
通常Arduinoから使う場合はI2C接続で使うことになると思いますが、<br/>
I2C接続は後日試すとして今回はこの方法で動作確認をしてみました</p>
<p>まずうちにはアンプ付きのスピーカなんて無いのでそれを用意するところから<br/>
せっかくなのでこれも秋月で買ってきて組み立ててみました<br/>
といっても個別にパーツを揃えたわけでなく</p>
<ul>
<li><a href="http://akizukidenshi.com/catalog/g/gK-08217/">ＰＡＭ８０１２使用２ワットＤ級アンプモジュール</a></li>
<li><a href="http://akizukidenshi.com/catalog/g/gK-05363/">３．５ｍｍステレオミニジャックＤＩＰ化キット</a></li>
<li><a href="http://akizukidenshi.com/catalog/g/gP-02679/">電池ボックス　単３×２本（リード線・耳付）</a></li>
<li>100均で売っているスピーカ</li>
</ul>
<p>これらを接続しただけです<br/>
今回試した手順を以下にまとめておきます<br/>
後半は技術資料に書いてあるものそのままで、どちらかと言うと前半が僕には必要でした</p>
<ol>
<li>ArduinoのLSIを取り外し、AquesTalkを取り付け</li>
<li>Arduinoのデジタル6番をアンプのIN+に接続</li>
<li>ArduinoのGNDをアンプのIN-に接続</li>
<li>アンプの+VとGNDをそれぞれ電池に接続</li>
<li>アンプのSPK+とSPK-をジャックのRとGに接続</li>
<li>ジャックにスピーカを接続</li>
<li>ArduinoをPCに接続、Arduino IDEを起動</li>
<li>メニューのTools -&gt; Serial Monitorを開く</li>
<li>右下のコンボボックスでCarriage returnと9600bpsを選択</li>
<li>上のインプットボックスに ...</li></ol>
                <a class="readmore" href="/posts/2014/07/aquestalk.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/2014/07/phantomjs.html" rel="bookmark"
                           title="Permalink to PhantomJSを使ってみた">PhantomJSを使ってみた</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-07-20T03:30:00">
                Published: 2014/07/20 Sun
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/lostmangoru.html">lostman/ごる</a>
        </address>
<p>In <a href="/category/programming.html">Programming</a>. </p>
<p>tags: <a href="/tag/javascript.html">JavaScript</a> <a href="/tag/phantomjs.html">PhantomJS</a> </p>
</footer><!-- /.post-info -->                <p>はじめて<a href="http://phantomjs.org/">PhantomJS</a>使ってみました<br/>
仕事で間接的に使ったことはありましたが、<br/>
プライベートで使ったのははじめてということでテストも兼ねて記事にしてみます</p>
<p>なにに使ったかというと<br/>
ドメインの管理ページのDNSの設定の書き換えの自動化です<br/>
このサイトのドメインは<a href="http://www.star-domain.jp/">スタードメイン</a>で管理しているのですが、<br/>
ここはDDNSの機能は提供していないんですね<br/>
このサイトはCNAMEを固定で設定できればいいので特に必要はないんですが、<br/>
サブドメインを使って固定IPアドレスでない自宅のマシンにもアクセスできるようにしたかったのです<br/>
ただ手動では面倒なのでできれば何らかの方法で自動的に更新しようと考えました</p>
<p>一般的には<a href="http://www.mydns.jp/">MyDNS</a>等の外部のDDNSの機能を提供しているサービスを使用して<br/>
このドメインで使用しているネームサーバをDDNSが提供しているものに変更するみたいです<br/>
一応この方法も試して動作することも確認しましたが、<br/>
PhantomJSを使って書き換える方法も比較的容易に実現できそうだったのでやってみました</p>
<p>ソースは<a href="https://github.com/lostman-github/stardomain-ddns">ここ</a>に置いてあります<br/>
READMEにも書いてありますが実行方法は以下です</p>
<div class="highlight"><pre>phantomjs stardomain-ddns.js <span class="s2">"&lt;email address&gt;"</span> <span class="s2">"&lt;password&gt;"</span> <span class="s2">"&lt;file name of DNS records&gt;"</span>
</pre></div>
<p>メールアドレスとパスワードはログインするために必要なもの<br/>
あとはDNSの設定が書いてあるファイルのファイル名を指定します<br/>
このファイルの中身はスタードメインの管理ページの<br/>
「レコード一括編集(テキストエリア)」のページに表示される形式にしておきます<br/>
なので一度手動で設定しておいて、一括編集の画面からコピペしてファイルを作ると簡単です<br/>
スクリプトを実行すると現在の設定とファイルの中身が一致しなかった場合更新します</p>
<p>このスクリプトを書くにあたってはまった部分がクリックの操作です<br/>
inputタグのボタンをクリックするには以下のようします</p>
<div class="highlight"><pre><span class="nx">funcs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">page ...</span></pre></div>
                <a class="readmore" href="/posts/2014/07/phantomjs.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/2014/07/pelican.html" rel="bookmark"
                           title="Permalink to Pelicanはじめました">Pelicanはじめました</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-07-20T00:10:00">
                Published: 2014/07/20 Sun
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/lostmangoru.html">lostman/ごる</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>. </p>
<p>tags: <a href="/tag/pelican.html">Pelican</a> </p>
</footer><!-- /.post-info -->                <p>Bloggerでブログを書いていましたが順次こちらへ移行する予定<br/>
このページは<a href="https://pages.github.com/">Github Pages</a>に<a href="http://blog.getpelican.com/">Pelican</a>で生成したコンテンツを置いています</p>
                <a class="readmore" href="/posts/2014/07/pelican.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
                </section><!-- /#content -->
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>